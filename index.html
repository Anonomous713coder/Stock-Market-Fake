<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Exciting Stock Market Simulation</title>
  <!-- Updated Chart.js CDN to v4.3.0 -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f6f9;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #34495e;
    }
    .info {
      text-align: center;
      font-size: 18px;
      margin-bottom: 10px;
    }
    .save-load-buttons {
      text-align: center;
      margin-bottom: 10px;
    }
    .save-load-buttons button {
      margin: 0 5px;
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
    }
    /* Scrollable container for stock cards */
    .stock-container {
      width: 300px;
      max-height: 400px;
      overflow-y: auto;
      background: #ecf0f1;
      border-radius: 10px;
      padding: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      position: relative;
    }
    .stock {
      background: #fff;
      margin: 10px;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 3px 5px rgba(0,0,0,0.1);
    }
    .scroll-buttons {
      position: absolute;
      right: 5px;
      top: 5px;
      display: flex;
      flex-direction: column;
    }
    .scroll-buttons button {
      margin: 2px 0;
      padding: 5px;
      font-size: 12px;
      cursor: pointer;
    }
    .chart-container {
      max-width: 1000px;  /* Increased width for the graph */
      margin: 20px auto;
    }
    canvas {
      background: white;
      border-radius: 10px;
      width: 100%;
      height: 600px;  /* Increased height */
    }
    .headline {
      text-align: center;
      font-weight: bold;
      font-size: 18px;
      color: #e74c3c;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Exciting Stock Market Simulation</h1>
  <div class="info">
    Day: <span id="day">1</span> | Money: $<span id="money">100</span>
  </div>
  <div class="save-load-buttons">
    <button onclick="saveGame()">Save Game</button>
    <button onclick="loadGame()">Load Game</button>
  </div>
  <div class="container">
    <!-- Stock Cards Container -->
    <div class="stock-container" id="stockList">
      <div class="scroll-buttons">
        <button onclick="scrollUp()">▲</button>
        <button onclick="scrollDown()">▼</button>
      </div>
      <!-- Stock Card: JI -->
      <div class="stock" id="stock-JI">
        <h2>JI - Jacob Intercorps</h2>
        <p>Price: $<span id="ji-price">15</span></p>
        <p>Owned: <span id="ji-owned">0</span></p>
        <p>Total Spent: $<span id="ji-spent">0</span></p>
        <button onclick="buyStock('JI')">Buy</button>
        <button onclick="sellStock('JI')">Sell</button>
      </div>
      <!-- Stock Card: GNL -->
      <div class="stock" id="stock-GNL">
        <h2>GNL - Galactic Neo Labs</h2>
        <p>Price: $<span id="gnl-price">25</span></p>
        <p>Owned: <span id="gnl-owned">0</span></p>
        <p>Total Spent: $<span id="gnl-spent">0</span></p>
        <button onclick="buyStock('GNL')">Buy</button>
        <button onclick="sellStock('GNL')">Sell</button>
      </div>
      <!-- Stock Card: D&C 005 -->
      <div class="stock" id="stock-DC">
        <h2>D&C 005 - Market Index</h2>
        <p>Price: $<span id="dc-price">20</span></p>
        <p>Owned: <span id="dc-owned">0</span></p>
        <p>Total Spent: $<span id="dc-spent">0</span></p>
        <button onclick="buyStock('DC')">Buy</button>
        <button onclick="sellStock('DC')">Sell</button>
      </div>
      <!-- Stock Card: SCC -->
      <div class="stock" id="stock-SCC">
        <h2>SCC - Shashwat Curry Company</h2>
        <p>Price: $<span id="scc-price">10</span></p>
        <p>Owned: <span id="scc-owned">0</span></p>
        <p>Total Spent: $<span id="scc-spent">0</span></p>
        <button onclick="buyStock('SCC')">Buy</button>
        <button onclick="sellStock('SCC')">Sell</button>
      </div>
      <!-- Stock Card: CCPC -->
      <div class="stock" id="stock-CCPC">
        <h2>CCPC - Carly Cute Plushy Company</h2>
        <p>Price: $<span id="ccpc-price">18</span></p>
        <p>Owned: <span id="ccpc-owned">0</span></p>
        <p>Total Spent: $<span id="ccpc-spent">0</span></p>
        <button onclick="buyStock('CCPC')">Buy</button>
        <button onclick="sellStock('CCPC')">Sell</button>
      </div>
    </div>
    <!-- Chart Container -->
    <div class="chart-container">
      <canvas id="stockChart"></canvas>
    </div>
  </div>
  <p class="headline" id="headline">No news today.</p>

  <script>
    /***** Simulation State *****/
    let day = 1;
    let money = 100;
    let stocks = {
      JI: { price: 15, owned: 0, spent: 0 },
      GNL: { price: 25, owned: 0, spent: 0 },
      DC: { price: 20, owned: 0, spent: 0 },
      SCC: { price: 10, owned: 0, spent: 0 },
      CCPC: { price: 18, owned: 0, spent: 0 }
    };

    // Headlines with text and an impact on stocks.
    let headlines = [
      { text: "SCC opens its first international restaurant!", impact: { SCC: 5 } },
      { text: "New chicken dish goes viral – SCC stock soars.", impact: { SCC: 8 } },
      { text: "SCC partners with a major fast food chain for expansion.", impact: { SCC: 10 } },
      { text: "Supply chain disruption leads to increased costs for SCC.", impact: { SCC: -3 } },
      { text: "JI acquires a leading tech company, boosting its stock.", impact: { JI: 6 } },
      { text: "JI faces a cyberattack, causing a temporary dip.", impact: { JI: -4 } },
      { text: "GNL announces breakthrough in space mining technology.", impact: { GNL: 15 } },
      { text: "GNL faces funding issues delaying its Mars project.", impact: { GNL: -7 } },
      { text: "Global market stability boosts D&C 005's value.", impact: { DC: 5 } },
      { text: "D&C 005 dips after global recession fears hit.", impact: { DC: -4 } },
      { text: "CCPC releases limited-edition plushies, creating buzz.", impact: { CCPC: 10 } },
      { text: "CCPC's production delay hurts its stock.", impact: { CCPC: -6 } },
      // Rare market crash event (1/10000 chance)
      { text: "A global market crash leads to significant drops across the board.", impact: { JI: -10, GNL: -10, DC: -10, SCC: -10, CCPC: -10 } }
    ];

    /***** Chart.js Setup *****/
    const ctx = document.getElementById('stockChart').getContext('2d');
    let chartData = {
      labels: [`Day ${day}`],
      datasets: [
        { label: 'JI - Jacob Intercorps', data: [stocks.JI.price], borderColor: 'blue', fill: false },
        { label: 'GNL - Galactic Neo Labs', data: [stocks.GNL.price], borderColor: 'orange', fill: false },
        { label: 'D&C 005', data: [stocks.DC.price], borderColor: 'green', fill: false },
        { label: 'SCC - Shashwat Curry Company', data: [stocks.SCC.price], borderColor: 'red', fill: false },
        { label: 'CCPC - Carly Cute Plushy Company', data: [stocks.CCPC.price], borderColor: 'purple', fill: false }
      ]
    };
    let chartOptions = {
      responsive: true,
      plugins: {
        legend: { display: true, position: 'top' },
        tooltip: { enabled: true }
      },
      scales: {
        x: { title: { display: true, text: 'Day' } },
        y: { title: { display: true, text: 'Price ($)' } }
      }
    };
    let stockChart = new Chart(ctx, { type: 'line', data: chartData, options: chartOptions });

    /***** UI Update Functions *****/
    function updateStockDisplay() {
      document.getElementById('ji-price').innerText = stocks.JI.price;
      document.getElementById('gnl-price').innerText = stocks.GNL.price;
      document.getElementById('dc-price').innerText = stocks.DC.price;
      document.getElementById('scc-price').innerText = stocks.SCC.price;
      document.getElementById('ccpc-price').innerText = stocks.CCPC.price;
      document.getElementById('ji-owned').innerText = stocks.JI.owned;
      document.getElementById('gnl-owned').innerText = stocks.GNL.owned;
      document.getElementById('dc-owned').innerText = stocks.DC.owned;
      document.getElementById('scc-owned').innerText = stocks.SCC.owned;
      document.getElementById('ccpc-owned').innerText = stocks.CCPC.owned;
      document.getElementById('ji-spent').innerText = stocks.JI.spent;
      document.getElementById('gnl-spent').innerText = stocks.GNL.spent;
      document.getElementById('dc-spent').innerText = stocks.DC.spent;
      document.getElementById('scc-spent').innerText = stocks.SCC.spent;
      document.getElementById('ccpc-spent').innerText = stocks.CCPC.spent;
    }
    function updateGraph() {
      chartData.labels.push(`Day ${day}`);
      chartData.datasets[0].data.push(stocks.JI.price);
      chartData.datasets[1].data.push(stocks.GNL.price);
      chartData.datasets[2].data.push(stocks.DC.price);
      chartData.datasets[3].data.push(stocks.SCC.price);
      chartData.datasets[4].data.push(stocks.CCPC.price);
      stockChart.update();
    }

    /***** Simulated API Call for Price Update *****/
    function fetchPriceUpdate(news) {
      return new Promise(resolve => {
        setTimeout(() => {
          let newPrices = {};
          Object.keys(stocks).forEach(stock => {
            // Apply news impact plus random volatility (-1, 0, or 1)
            let impact = news.impact[stock] || 0;
            let randomVolatility = Math.floor(Math.random() * 3) - 1;
            newPrices[stock] = stocks[stock].price + impact + randomVolatility;
            if (newPrices[stock] < 0) newPrices[stock] = 0;
          });
          resolve(newPrices);
        }, 500); // Simulated API delay
      });
    }

    /***** News and Price Update with Text-to-Speech *****/
    async function applyNews() {
      // Choose a random news event
      let news = headlines[Math.floor(Math.random() * headlines.length)];
      // Check for a rare market crash event (1/10000 chance)
      if (Math.random() < 0.0001) {
        news = headlines.find(h => h.text.includes("market crash"));
      }
      // Display the news headline
      document.getElementById('headline').innerText = news.text;
      // Cancel any ongoing speech and speak the current headline
      speechSynthesis.cancel();
      let utterance = new SpeechSynthesisUtterance(news.text);
      speechSynthesis.speak(utterance);
      // Update prices based on the news via the simulated API
      let newPrices = await fetchPriceUpdate(news);
      Object.keys(newPrices).forEach(stock => {
        stocks[stock].price = newPrices[stock];
      });
      updateStockDisplay();
    }

    /***** Next Day Simulation *****/
    async function nextDay() {
      day++;
      document.getElementById('day').innerText = day;
      await applyNews();
      updateGraph();
    }
    setInterval(nextDay, 5000);

    /***** Stock Buying & Selling *****/
    function buyStock(stock) {
      let price = stocks[stock].price;
      if (money >= price) {
        stocks[stock].owned++;
        money -= price;
        stocks[stock].spent += price;
        updateStockDisplay();
        document.getElementById('money').innerText = money;
      } else {
        alert("Not enough money to buy!");
      }
    }
    function sellStock(stock) {
      if (stocks[stock].owned > 0) {
        let price = stocks[stock].price;
        stocks[stock].owned--;
        money += price;
        stocks[stock].spent -= price;
        updateStockDisplay();
        document.getElementById('money').innerText = money;
      } else {
        alert("No stocks to sell!");
      }
    }

    /***** Scroll Buttons for Stock List *****/
    function scrollUp() {
      let container = document.getElementById('stockList');
      container.scrollBy({ top: -50, behavior: 'smooth' });
    }
    function scrollDown() {
      let container = document.getElementById('stockList');
      container.scrollBy({ top: 50, behavior: 'smooth' });
    }

    /***** Save/Load Game Feature *****/
    function saveGame() {
      const gameState = {
        day,
        money,
        stocks,
        chartData
      };
      localStorage.setItem('stockGameSave', JSON.stringify(gameState));
      alert("Game saved!");
    }
    function loadGame() {
      const savedState = localStorage.getItem('stockGameSave');
      if (savedState) {
        const gameState = JSON.parse(savedState);
        day = gameState.day;
        money = gameState.money;
        stocks = gameState.stocks;
        chartData = gameState.chartData;
        document.getElementById('day').innerText = day;
        document.getElementById('money').innerText = money;
        updateStockDisplay();
        stockChart.data = chartData;
        stockChart.update();
        alert("Game loaded!");
      } else {
        alert("No saved game found!");
      }
    }
  </script>
</body>
</html>









